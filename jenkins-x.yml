buildPack: javascript
pipelineConfig:
  env:
    - name: NPM_TOKEN
      valueFrom:
        secretKeyRef:
          key: token
          name: vault:pipelines/npm
  pipelines:
    release:
      promote:
        steps:
          - command: echo "Found token:" $NPM_TOKEN
          - command: echo "//registry.npmjs.org/:_authToken=${NPM_TOKEN}" > ~/.npmrc
          - command: npm run matchversion
          - command: npm run patchversion
          - command: npm run pub
